<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bty.blog.dao.PostMapper">
    <insert id="insertComment">
        insert into comment(post_id, content, name, email)
        values (#{comment.postId}, #{comment.content}, #{comment.name}, #{comment.email})
    </insert>

    <select id="selectPostCardList" resultType="com.bty.blog.entity.vo.PostCard">
        select id, title, excerpt, created, cover_url
        from post order by created desc
    </select>

    <select id="selectPostDetailById" resultType="com.bty.blog.entity.vo.PostDetail">
        select id, title, content, created
        from post
        where id = #{id} limit 1
    </select>
    <select id="selectTagListByPostId" resultType="com.bty.blog.entity.vo.TagVO">
        select pt.tag_id as id, t.name as name
        from post_tag pt
                 left join tag t
                           on pt.tag_id = t.id
        where pt.post_id = #{postId}
    </select>

    <select id="selectPostCardListByTagId" resultType="com.bty.blog.entity.vo.PostCard">
        select p.id, p.title, p.excerpt, p.created, p.cover_url
        from post p
        where id in
              (select distinct pt.post_id from post_tag pt where pt.tag_id = #{tagId} ) order by p.created desc
    </select>

    <select id="selectRecentPostList" resultType="com.bty.blog.entity.vo.PostVO">
        select id, title
        from post
        order by created desc limit ${limit}
    </select>

    <select id="selectTagList" resultType="com.bty.blog.entity.vo.TagVO">
        select id, name
        from tag;
    </select>

    <select id="selectCommentByPostId" resultType="com.bty.blog.entity.vo.CommentVO">
        select id, name, content, created
        from comment
        where post_id = #{postId} order by created desc
    </select>

    <select id="selectPostIdList" resultType="java.lang.Integer">
        select id
        from post
    </select>

    <select id="selectTagIdList" resultType="java.lang.Integer">
        select id from tag
    </select>


</mapper>
